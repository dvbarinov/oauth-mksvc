# OAuth 2.0 / OpenID Connect Authorization Server

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π **OAuth 2.0** –∏ **OpenID Connect (OIDC)**, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ —Å—Ç–µ–∫–µ **MERN + TypeScript**. –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Identity Provider) –¥–ª—è –≤–∞—à–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

---

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [API Endpoints](#-api-endpoints)
- [OAuth 2.0 / OIDC –ü–æ—Ç–æ–∫–∏](#-oauth-20--oidc-–ø–æ—Ç–æ–∫–∏)
- [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [Production Checklist](#-production-checklist)
- [–õ–∏—Ü–µ–Ω–∑–∏—è](#-–ª–∏—Ü–µ–Ω–∑–∏—è)

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç–∞–Ω–¥–∞—Ä—Ç |
|---------|----------|----------|
| **Authorization Code Flow** | –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π | RFC 6749 |
| **PKCE** | –ó–∞—â–∏—Ç–∞ –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ (SPA, Mobile) | RFC 7636 |
| **OpenID Connect** | –í—ã–¥–∞—á–∞ ID Token —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ | OpenID Core |
| **Refresh Tokens** | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access —Ç–æ–∫–µ–Ω–æ–≤ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ | RFC 6749 |
| **Token Revocation** | –û—Ç–∑—ã–≤ —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ logout | RFC 7009 |
| **Token Introspection** | –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–∞ —Ä–µ—Å—É—Ä—Å–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–æ–º | RFC 7662 |
| **OIDC Discovery** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ | OIDC Discovery |
| **JWKS** | –ü—É–±–ª–∏—á–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ JWT | RFC 7517 |
| **RS256 Signing** | –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞—è –ø–æ–¥–ø–∏—Å—å —Ç–æ–∫–µ–Ω–æ–≤ | RFC 7515 |
| **TypeScript** | –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞ | ‚Äî |
| **Zod Validation** | –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | ‚Äî |

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Frontend (Admin)                     ‚îÇ
‚îÇ                      React (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Backend (Node.js)                    ‚îÇ
‚îÇ   Express + TypeScript + Zod + JWT + bcrypt + crypto    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Database (MongoDB)                   ‚îÇ
‚îÇ   Users, OAuthClients, Tokens, AuthorizationCodes       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```json
{
  "express": "^4.19.2",
  "mongoose": "^8.5.0",
  "typescript": "^5.5.0",
  "zod": "^3.23.0",
  "jsonwebtoken": "^9.0.2",
  "bcrypt": "^5.1.1",
  "dotenv": "^16.4.5",
  "helmet": "^7.1.0",
  "cors": "^2.8.5",
  "express-session": "^1.18.0"
}
```

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Node.js** >= 18.0.0
- **MongoDB** >= 6.0 (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ Atlas)
- **npm** –∏–ª–∏ **yarn**

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd oauth-server
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è:

```bash
cp .env.example .env
```

### 4. –ó–∞–ø—É—Å–∫ MongoDB

**–õ–æ–∫–∞–ª—å–Ω–æ:**
```bash
mongod --dbpath /data/db
```

**Docker:**
```bash
docker run -d -p 27017:27017 --name mongodb mongo:7
```

### 5. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

**–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å hot-reload):**
```bash
npm run dev
```

**–ü—Ä–æ–¥–∞–∫—à–µ–Ω —Å–±–æ—Ä–∫–∞:**
```bash
npm run build
npm start
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:3001`

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------------|----------|--------|
| `PORT` | –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ | `3001` |
| `MONGODB_URI` | –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MongoDB | `mongodb://localhost:27017/oauth2db` |
| `ISSUER_URL` | –ë–∞–∑–æ–≤—ã–π URL –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–±–µ–∑ —Å–ª—ç—à–∞) | `https://auth.myapp.com` |
| `JWT_SECRET` | –°–µ–∫—Ä–µ—Ç –¥–ª—è HMAC —Ç–æ–∫–µ–Ω–æ–≤ (–º–∏–Ω. 32 —Å–∏–º–≤–æ–ª–∞) | `super_secret_key_...` |
| `SESSION_SECRET` | –°–µ–∫—Ä–µ—Ç –¥–ª—è —Å–µ—Å—Å–∏–π Express | `session_secret_...` |
| `FRONTEND_URL` | URL —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –¥–ª—è CORS | `http://localhost:3000` |
| `NODE_ENV` | –û–∫—Ä—É–∂–µ–Ω–∏–µ (`development` / `production`) | `production` |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```env
# –í production –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS
ISSUER_URL=https://auth.myapp.com

# –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –∫–æ–º–∞–Ω–¥–æ–π:
# openssl rand -base64 48
JWT_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
SESSION_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

---

## API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| `GET` | `/auth/login` | –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ |
| `POST` | `/auth/login` | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

### OAuth 2.0 / OIDC

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| `GET` | `/oauth/authorize` | Endpoint –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ |
| `POST` | `/oauth/authorize` | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–≥–ª–∞—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `POST` | `/oauth/token` | –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ |
| `GET` | `/oauth/userinfo` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ |
| `POST` | `/oauth/revoke` | –û—Ç–∑—ã–≤ —Ç–æ–∫–µ–Ω–∞ (RFC 7009) |
| `POST` | `/oauth/introspect` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ (RFC 7662) |

### Discovery & Keys

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| `GET` | `/.well-known/openid-configuration` | OIDC Discovery Document |
| `GET` | `/.well-known/jwks.json` | JSON Web Key Set |

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| `POST` | `/api/clients` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è OAuth –∫–ª–∏–µ–Ω—Ç–∞ |
| `GET` | `/api/clients` | –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

### Health Check

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| `GET` | `/health` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ |

---

## OAuth 2.0 / OIDC –ü–æ—Ç–æ–∫–∏

### Authorization Code Flow —Å PKCE

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Client ‚îÇ                    ‚îÇ Auth Server ‚îÇ                    ‚îÇ   User  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ                                ‚îÇ                                ‚îÇ
     ‚îÇ  1. Generate code_verifier     ‚îÇ                                ‚îÇ
     ‚îÇ     & code_challenge           ‚îÇ                                ‚îÇ
     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                                ‚îÇ
     ‚îÇ  2. /authorize?code_challenge  ‚îÇ                                ‚îÇ
     ‚îÇ                                ‚îÇ  3. Login Prompt               ‚îÇ
     ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                                ‚îÇ
     ‚îÇ                                ‚îÇ                                ‚îÇ
     ‚îÇ                                ‚îÇ  4. Consent Screen             ‚îÇ
     ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                                ‚îÇ
     ‚îÇ                                ‚îÇ                                ‚îÇ
     ‚îÇ  5. Redirect with auth_code    ‚îÇ                                ‚îÇ
     ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                                ‚îÇ
     ‚îÇ                                ‚îÇ                                ‚îÇ
     ‚îÇ  6. POST /token                ‚îÇ                                ‚îÇ
     ‚îÇ     + code_verifier            ‚îÇ                                ‚îÇ
     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                                ‚îÇ
     ‚îÇ                                ‚îÇ                                ‚îÇ
     ‚îÇ  7. access_token               ‚îÇ                                ‚îÇ
     ‚îÇ     refresh_token              ‚îÇ                                ‚îÇ
     ‚îÇ     id_token                   ‚îÇ                                ‚îÇ
     ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                                ‚îÇ
     ‚îÇ                                ‚îÇ                                ‚îÇ
```

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```http
GET /oauth/authorize?
  client_id=abc123&
  redirect_uri=https://app.com/callback&
  response_type=code&
  scope=openid%20profile%20email&
  state=random_state&
  nonce=random_nonce&
  code_challenge=E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM&
  code_challenge_method=S256
```

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ —Ç–æ–∫–µ–Ω–∞

```http
POST /oauth/token
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&
code=AUTH_CODE&
redirect_uri=https://app.com/callback&
client_id=abc123&
client_secret=secret123&
code_verifier=dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk
```

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "token_type": "Bearer",
  "expires_in": 900,
  "refresh_token": "d4f5e6g7-h8i9-j0k1-l2m3-n4o5p6q7r8s9",
  "scope": "openid profile email",
  "id_token": "eyJhbGciOiJSUzI1NiIs..."
}
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã –∑–∞—â–∏—Ç—ã

| –£–≥—Ä–æ–∑–∞ | –ú–µ—Ä–∞ –∑–∞—â–∏—Ç—ã |
|--------|-------------|
| **XSS** | Helmet.js, HttpOnly cookies |
| **CSRF** | `state` –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ OAuth flow |
| **Code Injection** | PKCE (RFC 7636) |
| **Token Theft** | –ö–æ—Ä–æ—Ç–∫–∏–π lifetime access —Ç–æ–∫–µ–Ω–∞ (15 –º–∏–Ω) |
| **Replay Attacks** | `nonce` –≤ ID Token |
| **Brute Force** | Rate limiting (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å) |
| **Enumeration** | –û–¥–∏–Ω–∞–∫–æ–≤—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ |
| **MITM** | –¢—Ä–µ–±—É–µ—Ç—Å—è HTTPS –≤ production |

### –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Access Token                         ‚îÇ
‚îÇ   ‚Ä¢ JWT (RS256/HS256)                                   ‚îÇ
‚îÇ   ‚Ä¢ Lifetime: 15 –º–∏–Ω—É—Ç                                  ‚îÇ
‚îÇ   ‚Ä¢ –•—Ä–∞–Ω–∏—Ç—Å—è: –≤ –ø–∞–º—è—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   Refresh Token                         ‚îÇ
‚îÇ   ‚Ä¢ Opaque string (UUID)                                ‚îÇ
‚îÇ   ‚Ä¢ Lifetime: 30 –¥–Ω–µ–π                                   ‚îÇ
‚îÇ   ‚Ä¢ –•—Ä–∞–Ω–∏—Ç—Å—è: –≤ MongoDB (–¥–ª—è –æ—Ç–∑—ã–≤–∞)                    ‚îÇ
‚îÇ   ‚Ä¢ Rotation: –Ω–æ–≤—ã–π –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     ID Token                            ‚îÇ
‚îÇ   ‚Ä¢ JWT (RS256)                                         ‚îÇ
‚îÇ   ‚Ä¢ Lifetime: 1 —á–∞—Å                                     ‚îÇ
‚îÇ   ‚Ä¢ –°–æ–¥–µ—Ä–∂–∏—Ç: sub, name, email, nonce                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Discovery Document

```bash
curl http://localhost:3001/.well-known/openid-configuration | jq
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ JWKS

```bash
curl http://localhost:3001/.well-known/jwks.json | jq
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Introspection

```bash
curl -X POST http://localhost:3001/oauth/introspect \
  -u "client_id:client_secret" \
  -d "token=YOUR_ACCESS_TOKEN"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Revocation

```bash
curl -X POST http://localhost:3001/oauth/revoke \
  -u "client_id:client_secret" \
  -d "token=YOUR_REFRESH_TOKEN"
```

---

## Production Checklist

### –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º —É–±–µ–¥–∏—Ç–µ—Å—å:

- [ ] **HTTPS** –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è OAuth/OIDC)
- [ ] **ISSUER_URL** —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- [ ] **–°–µ–∫—Ä–µ—Ç—ã** —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å—Ç–æ–π–∫–∏–µ
- [ ] **MongoDB** –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- [ ] **CORS** –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏
- [ ] **Rate Limiting** –≤–∫–ª—é—á—ë–Ω –Ω–∞ `/token` –∏ `/login`
- [ ] **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ (winston/pino)
- [ ] **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –Ω–∞—Å—Ç—Ä–æ–µ–Ω (health checks, metrics)
- [ ] **Backup** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω
- [ ] **–ö–ª—é—á–∏ RSA** —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–Ω–µ –≤ –ø–∞–º—è—Ç–∏)

### Docker Compose (–ø—Ä–∏–º–µ—Ä)

```yaml
version: '3.8'
services:
  oauth-server:
    build: .
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - MONGODB_URI=mongodb://mongo:27017/oauth2db
      - ISSUER_URL=https://auth.myapp.com
    depends_on:
      - mongo

  mongo:
    image: mongo:7
    volumes:
      - mongo_/data/db

volumes:
  mongo_
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏

### NextAuth.js

```typescript
// pages/api/auth/[...nextauth].ts
import NextAuth from "next-auth"
import { OAuthConfig } from "next-auth/providers"

export default NextAuth({
  providers: [
    {
      id: "custom-oauth",
      name: "Custom OAuth",
      type: "oauth",
      version: "2.1",
      clientId: process.env.OAUTH_CLIENT_ID,
      clientSecret: process.env.OAUTH_CLIENT_SECRET,
      authorization: {
        url: "https://auth.myapp.com/oauth/authorize",
        params: { scope: "openid profile email" }
      },
      token: "https://auth.myapp.com/oauth/token",
      userinfo: "https://auth.myapp.com/oauth/userinfo",
      profile(profile) {
        return {
          id: profile.sub,
          name: profile.name,
          email: profile.email
        }
      }
    }
  ]
})
```

### oidc-client-ts (React)

```typescript
import { UserManager, WebStorageStateStore } from 'oidc-client-ts';

const userManager = new UserManager({
  authority: 'https://auth.myapp.com',
  client_id: 'your-client-id',
  redirect_uri: 'https://app.com/callback',
  response_type: 'code',
  scope: 'openid profile email',
  userStore: new WebStorageStateStore({ store: window.localStorage })
});

// –ù–∞—á–∞–ª–æ –≤—Ö–æ–¥–∞
await userManager.signinRedirect();

// –û–±—Ä–∞–±–æ—Ç–∫–∞ callback
const user = await userManager.signinRedirectCallback();

// –í—ã—Ö–æ–¥
await userManager.signoutRedirect();
```

---

## –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–¥–∞–Ω–Ω—ã—Ö/–æ—Ç–æ–∑–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ rate limits

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License ‚Äî —Å–º. —Ñ–∞–π–ª [LICENSE](LICENSE) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.

---

## –ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ–º —Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤

- [RFC 6749](https://tools.ietf.org/html/rfc6749) ‚Äî OAuth 2.0
- [RFC 6750](https://tools.ietf.org/html/rfc6750) ‚Äî Bearer Token
- [RFC 7009](https://tools.ietf.org/html/rfc7009) ‚Äî Token Revocation
- [RFC 7515](https://tools.ietf.org/html/rfc7515) ‚Äî JWT
- [RFC 7517](https://tools.ietf.org/html/rfc7517) ‚Äî JWK
- [RFC 7636](https://tools.ietf.org/html/rfc7636) ‚Äî PKCE
- [RFC 7662](https://tools.ietf.org/html/rfc7662) ‚Äî Token Introspection
- [OpenID Connect Core](https://openid.net/specs/openid-connect-core-1_0.html)

---

**–°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**